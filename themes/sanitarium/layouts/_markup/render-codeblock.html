{{- $lang := .Type -}}
{{- $code := .Inner -}}
{{- $attributes := .Attributes -}}

{{- /* Check if no-copy-button class is present */ -}}
{{- $noCopyButton := false -}}
{{- with $attributes.class -}}
  {{- if in (split . " ") "no-copy-button" -}}
    {{- $noCopyButton = true -}}
  {{- end -}}
{{- end -}}

{{- /* Create classes, preserving existing ones */ -}}
{{- $classes := "" -}}
{{- with $attributes.class -}}
  {{- $classes = printf "%s" . -}}
{{- end -}}

{{- /* Add copy-enabled class unless disabled */ -}}
{{- if not $noCopyButton -}}
  {{- $classes = printf "%s copy-enabled" $classes -}}
{{- end -}}

<div class="{{ $classes }}">
  {{- if not $noCopyButton -}}
  <button class="copy-button" aria-label="Copy code to clipboard" title="Copy to clipboard">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span class="copy-text">Copy</span>
    <span class="copied-text">Copied!</span>
  </button>
  {{- end -}}
  
  {{ highlight $code $lang "" }}
</div>
